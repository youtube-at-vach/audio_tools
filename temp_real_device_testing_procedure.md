# 実機を用いたオーディオ測定ツールの検証手順

## 目的

本ドキュメントは、開発中のオーディオ測定ツール群が実機環境において正しく機能し、特に計算結果の正確性が確保されていることを検証するための手順を定めるものです。各ツールの出力が、既知の入力信号や信頼できる外部測定器のデータと一致することを確認します。

## 測定の前提条件：明確なループバック経路の確保

多くのテストは、オーディオインターフェースの出力を入力に直接接続する「ループバック」接続を前提としています。しかし、デバイスの内部ミキサー等により意図した経路が確立されているか不明確な場合があります。

測定を開始する前に `audio_loopback_finder.py` を使用し、アクティブなオーディオ経路を特定・確認してください。明確なループバックが確認できてから、各ツールの検証に進んでください。

## dBFSの定義と使い分け

本ツール群では、音量レベルの表現にdBFS (decibels relative to full scale) を使用します。測定結果の解釈に影響するため、以下の指針を理解してください。

### 1. ピークdBFS (Peak dBFS)

*   **定義**: デジタル信号の瞬間的な最大振幅（ピーク値）を基準としたdB値。0 dBFSがクリッピングの発生する最大レベルです。
*   **主な用途**: 信号の生成時や、デジタルクリッピングを防ぐための最大レベルの監視。

### 2. RMS dBFS (Root Mean Square dBFS)

*   **定義**: 信号の平均的なパワー（実効値）を基準としたdB値。人間の聴覚が感じる「音量」に近い指標です。
*   **主な用途**: 信号の平均的なレベル、ノイズフロア、ゲイン、SNRなどのオーディオ分析。

### 本プロジェクトにおける指針

*   **信号の生成や最大レベルの指定**: **ピークdBFS**を使用します。
*   **信号の分析（ゲイン、ノイズ、ラウドネス等）**: **RMS dBFS**を使用します。

## 全体的なアプローチ

1.  **基準となるハードウェアの準備**: 信頼性の高いオーディオインターフェース、校正済みマイク、高品質なケーブルを用意します。
2.  **基準信号の生成**: ツール自身 (`audio_signal_generator.py`) または外部の信号発生器で正確なテスト信号を生成します。
3.  **比較検証**: ツールの出力値を、理論値や信頼できる分析ソフトウェア/ハードウェア（例: REW, オシロスコープ）の結果と比較します。
4.  **段階的なテスト**: 各ツールを個別にテストした後、必要に応じて複数のツールを組み合わせてテストします。
5.  **詳細な記録**: 各テストの条件、測定結果、期待値との差異、およびその原因を詳細に記録します。

## 仮想ループバックデバイスの活用

新たに仮想ループバックデバイス（ID 15: LoopCombined, ALSA）を導入しました。今後は、物理デバイスを用いたテストに加え、この仮想デバイスを積極的に活用し、ソフトウェア的なテストを優先します。これにより、物理的な接続や環境に依存しない、安定したテスト環境を構築し、開発効率の向上を図ります。

## 検証結果の記録

各Testについて、以下の情報を記録します。

*   **テスト日時**:
*   **ツール名とバージョン**:
*   **テスト環境**: OS, Pythonバージョン, オーディオインターフェースのモデル, 接続方法など。
*   **テスト条件**: 使用したオプション、入力信号の特性（周波数、振幅など）。
*   **期待される結果**: 理論値、外部測定器の参照値など。
*   **実際の測定結果**: ツールの出力値。
*   **差異と考察**: 期待値との差異、その原因（判明した場合）、改善点など。
*   **スクリーンショット/プロット**: 視覚的な結果がある場合は添付。

## 今後の測定計画

現在の検証は、ツールの基本的な計算精度を確認する最初のステージです。今後は、以下のステージに進むことを計画しています。

### ステージ1: 基本性能評価（現在実施中）
*   **内容**: ループバック接続による各ツールの基本的な精度検証。
*   **目的**: ツールの計算ロジックとアルゴリズムの正当性を、理想的な条件下で確認する。

### ステージ2: 多様なハードウェアでの検証
*   **内容**: 複数の異なるオーディオインターフェースを使用し、ステージ1と同様のテストを再度実施する。
*   **目的**: OSやドライバ、ハードウェア実装の違いによる影響を吸収できているかを確認し、ツールの汎用性と安定性を高める。

### ステージ3: 実環境での音響測定
*   **内容**: マイクとスピーカーをシステムに組み込み、実際の部屋の音響特性を測定する。
*   **目的**: ツールが、電気的なループバックだけでなく、マイクやスピーカーを含む音響測定という、より実用的なシナリオで機能することを確認する。

### ステージ4: アナログ機器の特性測定
*   **内容**: ターンテーブル、カセットデッキ、プリアンプなどのアナログ機器を測定対象とする。
*   **目的**: アナログ機器特有の微細な変動や歪みを正確に捉え、分析できるかを確認する。

### ステージ5: 自動化とレポート生成
*   **内容**: 一連のテストを自動で連続実行し、結果をまとめてHTMLやPDF形式のレポートとして出力する機能の開発。
*   **目的**: 測定プロセスの大幅な効率化と、結果の比較・共有を容易にする。