これは実装者が**最大限柔軟に判断・設計できるように**、機能と構成要素に焦点を当てた**設計思想ベースの草案**です。実装方針・ツール選定・UI等には言及せず、構造的自由度を重視しています。

---

## 📄 ノイズ分離スペクトラム解析プログラム ― 総合仕様草案

### 📌 概要

本プログラムは、オーディオ波形信号を解析し、周波数スペクトル上の構造に基づいて複数のノイズ成分（ホワイトノイズ、1/fノイズ、商用電源成分、突発ノイズなど）を自動的に分類・定量化・可視化することを目的とする。

---

### 🎯 目標と出力例

* 入力信号のスペクトルを解析し、ノイズ成分ごとの\*\*寄与割合（RMS電圧ベース、または電力比）\*\*を算出。
* 周波数スペクトルと分類結果を**視覚的に提示**（例：log-logプロット、積分割合グラフ）。
* 最終的な出力例（柔軟なフォーマット選択を許容）：

  ```
  総合ノイズ電圧: 1.42 μV RMS
  分類内訳:
    - ホワイトノイズ: 0.89 μV (39%)
    - 1/fノイズ: 0.61 μV (28%)
    - 商用電源ノイズ（50Hz系）: 0.74 μV (32%)
    - その他ノイズ: 0.09 μV (1%)
  対象周波数範囲: 1 Hz ～ 48 kHz
  ```

---

### 🧩 処理構成（推奨ステップ）

#### 1. 入力

* 時間波形信号（WAVファイル、ストリーム、またはサンプル列）
* サンプルレート：48kHz以上を推奨
* サンプル長：低周波ノイズを含めるため、**10秒以上推奨**

#### 2. 前処理

* DC成分の除去
* 必要に応じたウィンドウ関数（例：Hann）
* オーバーラップ／セグメント分割（実装者の裁量で選択）

#### 3. スペクトル解析

* パワースペクトル密度（PSD）の算出

  * Welch法、STFT、FFT等のいずれでも可
  * 単位は V²/Hz または dBV/√Hz
* 分解能は商用電源ノイズ検出のために1Hz以下が望ましい

#### 4. ノイズ成分の分類ロジック

分類対象と分類方針：

| 種類              | 特徴             | 分類ロジック（参考）                |
| --------------- | -------------- | ------------------------- |
| ホワイトノイズ         | 周波数に依存せず一定     | ログスペクトル傾き ≈ 0             |
| 1/fノイズ          | 低周波ほど増加        | 傾き ≈ -10 dB/decade（≒ 1/f） |
| 商用電源ノイズ         | 50Hz/60Hz と高調波 | ピーク検出またはバンド積分 ±Δf         |
| その他（突発、帯域ノイズなど） | 明確な傾向を持たない     | 残差、またはパルス検出などで処理          |

* 上記の分類は排他的でなくてもよい（重複または曖昧領域の処理は実装者の判断に委ねる）。
* 商用電源ノイズの高調波は、**最大次数を指定可能**にすることが望ましい。

#### 5. 分量評価・積分

* 各分類ごとに周波数帯域を積分して、RMS電圧またはエネルギー比を算出
* 相対割合（％表示）または電圧値表示の双方に対応

#### 6. 表示・出力

* 分類ごとのノイズ量を視覚化

  * PSDグラフ（色分け）
  * 棒グラフまたは円グラフによる成分割合
* 出力フォーマットは実装者の判断に委ねる（CLI出力、GUI、Web UI など）

---

### 📦 オプション・拡張候補（任意実装）

| 機能             | 内容                         |
| -------------- | -------------------------- |
| 商用電源成分の自動検出    | 最も強いピークを基準に50/60Hzモードを自動判定 |
| ログスケールのフィッティング | スペクトル傾きを自動分類に使用（回帰）        |
| ノイズソース推定タグ付け   | 電源由来、熱雑音、アンプ起因など簡易判定ラベル    |
| リアルタイム動作対応     | 時系列的にノイズ成分の遷移を追跡（未分類→分類）   |
| 生信号監視モード       | 一定時間ごとの自動スナップショット保存や平均化    |

---

### ⚠ 注意点と柔軟性への配慮

* ノイズ分類の厳密性は**物理的起源の厳密な同定を意図せず**、スペクトル形状に基づく**便宜的な分類**とする。
* 実装においては、分類しきれない残差成分や、明確に分離できない領域は「その他」または「未分類」として処理可能。
* 実装者は上記のロジックを**固定アルゴリズムとせず、観測データに応じた柔軟な分類戦略を選択できる**。

---

### 🔚 補足

* 本仕様は開発者に対して**分析対象の構造と目的のみを明示する**ものであり、技術選定・言語・可視化手段・出力形式には制限を課さない。
* 実装者はこの仕様を踏まえた上で、目的に適した形で構成・最適化・簡略化・拡張を自由に行ってよい。

---

必要であれば、この仕様をMarkdown形式のファイルに整形することもできます。ご希望でしょうか？
